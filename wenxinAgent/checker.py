from .WenxinBot import WenxinBot
from dotenv import dotenv_values
config = dotenv_values('.wenxinenv')
PROMPT = """你是一个Web安全扫描助手，你懂得使用NMAP以及W3AF，你的工作是判断一个扫描步骤应该由人去完成还是由Nmap或w3af去完成，扫描步骤会以[user input]xxxxx[user input end]的形式给你，你需要用[result]xxx的格式给出你的判断，如果该步骤应该由人去完成，输出manu，如果应该由Nmap或者w3af去完成，输出auto，对你的第一要求是不要输出额外的内容，只输出auto这四个字符或者auto这四个字符，下面给你一个例子：
[user input]
使用Nmap判断127.0.0.1上是否存在sql注入漏洞
[user input end]
[result]
auto
如果需要人工完成，例子如下：
[user input]
确认Nmap扫描的目标ip和端口范围
[user input end]
[result]
manu
注意严格根据上述指示进行输出，只输出manu或者auto，除了manu或者auto其余任何内容都不要输出。输出完manu或auto之后立刻终止输出，不要再输出任何字符。以上为给你的工作范例，以下为真实应用场景:
[user input]
{$userinput$}
[user input end]

[result]
"""
class checker:
    def __init__(self) -> None:
        self.bot = WenxinBot()
        self.bot.get_access_token()
        self.prompt_template = PROMPT
    def make_prompt(self, query):
        prompt = self.prompt_template.replace("{$userinput$}",query)
        return prompt
    def query2bot(self, query):
        query = self.make_prompt(query)
        return self.bot.send_message(query)

if __name__ == '__main__':
    p = checker()
    p.query2bot("你好")
    p.query2bot('检查127.0.0.1上是否存在sql注入问题')